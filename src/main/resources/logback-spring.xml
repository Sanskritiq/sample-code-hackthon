<configuration>
  <!-- Console appender for local development -->
  <appender name="CONSOLE" class="ch.qos.logback.core.ConsoleAppender">
    <encoder>
      <pattern>%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level [%logger{36}] - %msg%n</pattern>
    </encoder>
  </appender>

  <!-- Google Cloud Logging appender -->
  <appender name="CLOUD" class="com.google.cloud.logging.logback.LoggingAppender">
    <!-- Don't filter - let all logs through -->
    <log>payment-backend</log>
    <resourceType>cloud_run_revision</resourceType>
    <flushLevel>INFO</flushLevel>
    <includeLocation>true</includeLocation>
    <includeMdc>true</includeMdc>
  </appender>

  <!-- Profile-specific configuration -->
  <springProfile name="!prod">
    <!-- Use console logging for non-production -->
    <root level="INFO">
      <appender-ref ref="CONSOLE" />
    </root>
  </springProfile>

  <springProfile name="prod">
    <!-- Use both console and cloud logging for production -->
    <root level="INFO">
      <appender-ref ref="CONSOLE" />
      <appender-ref ref="CLOUD" />
    </root>
    
    <!-- Set specific loggers to DEBUG for more visibility -->
    <logger name="com.yourpackage" level="DEBUG" additivity="false">
      <appender-ref ref="CONSOLE" />
      <appender-ref ref="CLOUD" />
    </logger>
  </springProfile>

  <!-- Fallback configuration -->
  <root level="INFO">
    <appender-ref ref="CONSOLE" />
    <appender-ref ref="CLOUD" />
  </root>
  
  <!-- HTTP request logging -->
  <logger name="org.springframework.web" level="DEBUG" />
  <logger name="org.springframework.security" level="DEBUG" />
</configuration>